{% extends "base.html" %}
{% block title %}
CyberRange
{% endblock %}
{% block content %}

<div id="admin_area" class="content-container">
  <div class="content results-container">
  <h1>Results</h1>

    {% if results_table %}
    <h2>Overview</h2>
    <div class="table_wrapper">
      <table id="results_table">
        <tr>
          {% for column in results_table.columns %}
            <th>
              {{ column.col_name }}
              <input type="hidden" value="{{ column.col_id }}">
            </th>
          {% endfor %}
        </tr>

        {% for entry in results_table.rows %}
          <tr>
            {% for key, value in entry.items() %}
              {% if key != "user_id" %}
                <td>
                  {% if key != "username"  %}
                    {% if value == 1 %}

                      <div class="stat_indicator success">
                        <svg class="bi stat_icon" width="24" height="24" role="img">
                          <use xlink:href="#success"></use>
                        </svg>
                      </div>

                    {% elif value == -1 %}
                    <b class="no_value">-</b>
                    {% else %}

                    <div class="stat_indicator failed">
                      <svg class="bi stat_icon" width="24" height="24" role="img">
                        <use xlink:href="#fail"></use>
                      </svg>
                    </div>
                    {% endif %}
                  <input type="hidden" value='/result/{{ entry["user_id"] }}/{{ key }}'>
                  {% else %}
                    {{ value }}
                  {% endif %}
                </td>
              {% endif %}
              {% endfor %}
            </tr>
            {% endfor %}
          </table>
        </div>
        <hr style="margin: 70px 0px;">
      {% endif %}

    <h2>Results List</h2>

    {% for section, pages in exercises.items() %}

      <div class="section">
      <h2>{{ section | safe }}</h2>

      {% for page, page_exercises in pages.items() %}
        <hr>
        <h3>{{ page | safe }}</h3>

        <ul>
          {% for exercise in page_exercises %}
          <a href="/result/{{ exercise.global_exercise_id }}">
            <li>
              <h4>
                {{ exercise.exercise_name | safe }}
                <span class="percentage">
                  {{ '%0.2f' % exercise.completion_percentage | float }} %</span>
              </h4>
            </li>
          </a>
          {% endfor %}
        </ul>

        {% endfor %}

      </div>

      {% endfor %}

  </div>
</div>

<div id="preloader" class="content-container pager">
  <div class="lds-ring">
    <div></div>
    <div></div>
    <div></div>
    <div></div>
  </div>
</div>
{% endblock %}
